(()=>{"use strict";class t{constructor(){this._allPosts=[],this._container=void 0,this._content=void 0,this._coords=void 0,this._element=void 0,this._form=void 0,this._modal=void 0,this._posts=void 0,this.onResetModalForm=this.onResetModalForm.bind(this),this.onSubmitForm=this.onSubmitForm.bind(this),this.onSubmitModalForm=this.onSubmitModalForm.bind(this)}addPost(){const o=this._form.querySelector(t.selectorFormInput);this._allPosts.push({text:o.value,coords:this._coords,time:Date.now()}),o.value=""}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this._container=t}checkBinding(){if(void 0===this._container)throw new Error("Timeline not bind to DOM")}drawUI(){this.checkBinding(),document.body.insertAdjacentHTML("beforeend",t.markupModal),this._modal=document.body.querySelector(t.selectorModal);const o=this._modal.querySelector("form");o.addEventListener("reset",this.onResetModalForm),o.addEventListener("submit",this.onSubmitModalForm),this._container.innerHTML=t.markup,this._element=this._container.querySelector(t.selector),this._content=this._element.querySelector(t.selectorContent),this._form=this._element.querySelector(t.selectorForm),this._posts=this._content.querySelector(t.selectorPosts),this._form.addEventListener("submit",this.onSubmitForm),this.redrawDOM()}getGeolocation(t,o){navigator.geolocation?navigator.geolocation.getCurrentPosition(t,o,{enableHighAccuracy:!0}):o({code:999,message:"User browser does not support Geolocation"})}onResetModalForm(){this._modal.classList.remove("active"),this._modal.querySelector(t.selectorModalFormHint).textContent="",this._modal.querySelector(t.selectorModalFormInput).value=""}onSubmitForm(t){if(console.log("onSubmitForm",t),t.preventDefault(),this._coords)return this.addPost(),void this.redrawDOM();this.getGeolocation((t=>{this._coords=t.coords,console.log("lat "+this._coords.latitude),console.log("long "+this._coords.longitude),this.addPost(),this.redrawDOM()}),(t=>{console.log(t),this._modal.classList.add("active")}))}onSubmitModalForm(o){console.log("onSubmitModalForm",o),o.preventDefault();const e=this._modal.querySelector(t.selectorModalFormHint),s=this._modal.querySelector(t.selectorModalFormInput);e.textContent="";try{this._coords=function(t){const o=/^\[?(-?\d+(?:\.\d+)?),\s?(-?\d+(?:\.\d+)?)\]?$/,e=t.match(o);if(console.log(t,o,e),null===e)throw new Error("Некорректный формат координат");return{latitude:Number(e[1]),longitude:Number(e[2])}}(s.value),this.addPost(),this._modal.classList.remove("active"),s.value="",this.redrawDOM()}catch(t){console.error(t),e.textContent=t.message}}redrawDOM(){this._posts.innerHTML="",this._allPosts.length?(this._posts.style.height="",this._posts.classList.remove("timeline__posts--empty"),this._allPosts.forEach((o=>{this._posts.insertAdjacentHTML("afterbegin",t.markupPost(o))})),this._posts.style.height=this._posts.offsetHeight>this._content.offsetHeight?this._posts.offsetHeight+"px":this._content.offsetHeight+"px"):(this._posts.classList.add("timeline__posts--empty"),this._posts.style.height=this._content.offsetHeight+"px")}static get markup(){return'\n      <div class="timeline">\n        <div class="timeline__content">\n          <div class="timeline__posts timeline__posts--empty"></div>\n        </div>\n        <form class="timeline__form timeline-form">\n          <input class="timeline-form__input">\n          \x3c!--<button class="timeline-form__btn-submit" type="submit">\n            <svg viewBox="0 0 320 512" xmlns="http://www.w3.org/2000/svg">\n              <path d="M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z" />\n            </svg>\n          </button>--\x3e\n        </form>\n      </div>\n    '}static get markupModal(){return'\n      <div class="modal-coords">\n        <form class="modal-coords__content">\n          <div class="modal-coords__header">\n            <h2 class="modal-coords__title">Что-то пошло не так</h2>\n          </div>\n          <div class="modal-coords__body">\n            <p class="modal-coords__description">\n              К сожалению, нам не удалось определить ваше местоположение, пожалуйста, дайте\n              разрешение на использование геолокации, либо введите координаты вручную.\n            </p>\n            <div class="modal-coords__form-group">\n              <label class="modal-coords__form-label" for="modal-coords-input">\n                Широта и долгота через запятую\n              </label>\n              <input class="modal-coords__form-input" id="modal-coords-input" placeholder="51.50851, -0.12572">\n              <div class="modal-coords__form-hint"></div>\n            </div>\n          </div>\n          <div class="modal-coords__footer">\n            <button class="modal-coords__btn-reset" type="reset">Отмена</button>\n            <button class="modal-coords__btn-submit" type="submit">OK</button>\n          </div>\n        </form>\n      </div>\n    '}static markupPost(t){const o=new Date(t.time),e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),i=String(o.getDate()).padStart(2,"0"),n=String(o.getHours()).padStart(2,"0"),r=String(o.getMinutes()).padStart(2,"0"),l=`${e}-${s}-${i}T${n}:${r}:${String(o.getSeconds()).padStart(2,"0")}`,a=`${i}.${s}.${e} ${n}:${r}`;return`\n      <div class="timeline__post timeline-post">\n        <div class="timeline-post__description">\n          <p class="timeline-post__text">${t.text}</p>\n          <span class="timeline-post__coordinates">\n            [${t.coords.latitude}, ${t.coords.longitude}]\n          </span>\n        </div>\n        <time class="timeline-post__datetime" datetime="${l}">${a}</time>\n      </div>\n    `}static get selector(){return".timeline"}static get selectorContent(){return".timeline__content"}static get selectorForm(){return".timeline-form"}static get selectorFormInput(){return".timeline-form__input"}static get selectorModal(){return".modal-coords"}static get selectorModalFormHint(){return".modal-coords__form-hint"}static get selectorModalFormInput(){return".modal-coords__form-input"}static get selectorPosts(){return".timeline__posts"}}document.addEventListener("DOMContentLoaded",(()=>{const o=document.querySelector("#app"),e=new t;e.bindToDOM(o),e.drawUI()}))})();